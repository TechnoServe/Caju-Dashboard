

{% extends 'layouts/base.html' %}
{% load i18n %}


{% block title %} Tables {% endblock title %}

{% block content %}
  <div class="header bg-primary pb-6">
    <div class="container-fluid">
      <div class="header-body">
        <div class="row align-items-center py-4">
          <div class="col-lg-6 col-7">
            <h6 class="h2 text-white d-inline-block mb-0">{% trans "Nut Count" %}</h6>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- Page content -->
    <div class="container-fluid mt--6">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <!-- Card header -->
                    <div class="card-header border-0" style="background-color: #f7f7f7">
                        <h3 class="mb-0">{% trans "Nut count average per Departement" %}</h3>
                    </div>
                    <div class="chart-container" style="position: relative;">
                        <canvas id="department_Chart" width="40" height="10"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                <!-- Card header -->
                    <div class="card-header border-0" style="background-color: #f7f7f7">
                        <h3 class="mb-0">{% trans "Nut count average per Commune" %}</h3>
                    </div>
                    <div class="card-body border-0">
                        <div class="chart-container" style="position: relative;">
                            <canvas id="commune_Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form method="POST">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                    <!-- Card header -->
                        <div class="card-header border-0" style="background-color: #f7f7f7">
                            <h3 class="mb-0">{% trans "Nut count average per Departement communes" %}</h3>
                            <br>
                                <label for="departments">{% trans "Select Department: " %}</label>
                                    {{ Department_choice.department }}
                                <button type="submit" class="btn btn-primary">{% trans "Submit" %}</button>
                        </div>
                        <div class="card-body border-0">
                            <div class="chart-container" style="position: relative;">
                                <canvas id="dep_commune_Chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header border-0" style="background-color: #f7f7f7">
                            <h3 class="mb-0">{% trans "Nut count Graph against date period" %}</h3>
                            <br>
                                {{ form.as_table }}
                              <button type="submit" class="btn btn-primary">{% trans "Submit" %}</button>
                        </div>
                        <div class="chart-container" style="position: relative;">
                            <canvas id="Nut_count_Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>



{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
        <script type="text/javascript">
            function generateRandomColor(){
                let maxVal = 0xFFFFFF; // 16777215
                let randomNumber = Math.random() * maxVal;
                randomNumber = Math.floor(randomNumber);
                randomNumber = randomNumber.toString(16);
                let randColor = randomNumber.padStart(6, 0);
                return `#${randColor.toUpperCase()}`
            }
            var department_labels = {{ department_name|safe }}
            var department_datas = {{ department_sum_list|safe }}
            var department_dataset = []
            for (let i in department_datas) {
                const r = Math.floor(Math.random() * 255);
                const g = Math.floor(Math.random() * 255);
                const b = Math.floor(Math.random() * 255);
               department_dataset.push('rgba('+r+', '+g+', '+b+', 0.6)');
            }
            const department_data = {
            labels: department_labels,
            datasets: [{
                    label: 'Nut count average per Departement',
                data: department_datas,
                backgroundColor: department_dataset,
                }]
            };
            const department_config = {
                type: 'polarArea',
                data: department_data,
                options: {
                    scales: {
                       r: {
                           ticks: {
                               z: 1,
                               showLabelBackdrop: true,
                               backdropColor: "rgba(255,255,255,0.5)",
                               font: {
                                   weight: 600
                               }
                           },
                           grid: false,
                       }
                    }
                }
            };

            const department_Chart = new Chart(
                document.getElementById('department_Chart'),
                department_config,
            );

            var labels_commune = {{ commune_name|safe }}
            var datas_commune = {{ commune_sum_list|safe }}
            var dataset_commune = []
            for (let i in datas_commune) {
                const r = Math.floor(Math.random() * 255);
                const g = Math.floor(Math.random() * 255);
                const b = Math.floor(Math.random() * 255);
               dataset_commune.push('rgba('+r+', '+g+', '+b+', 0.6)');
            }
            const commune_data = {
            labels: labels_commune,
            datasets: [{
                    label: 'Nut count average per Commune',
                data: datas_commune,
                backgroundColor: dataset_commune,
                hoverBorderWidth: "30px",
                }]
            };
            const commune_config = {
                type: 'polarArea',
                data: commune_data,
                options: {
                    scales: {
                       r: {
                           ticks: {
                               z: 1,
                               showLabelBackdrop: true,
                               backdropColor: "rgba(255,255,255,0.5)",
                               font: {
                                   weight: 600,
                               },
                           },
                           grid: false,
                       }
                    }
                }
            };
            const commune_Chart = new Chart(
                document.getElementById('commune_Chart'),
                commune_config
            );

            var Nut_count_labels = {{ Nut_count_time|safe }}
            var Nut_count_datas = {{ per_Nut_count|safe }}
            var Nut_count_color = []
            for (let i in Nut_count_datas) {
               var color1 = generateRandomColor();
               Nut_count_color.push(color1)
            }
            const data = {
              labels: Nut_count_labels,
              datasets: [
                {
                  label: 'Nut count Graph against date period',
                  data: Nut_count_datas,
                  borderColor: generateRandomColor(),
                  backgroundColor: 'white',
                  fill: false,
                    tension: 0.4
                }
              ]
            };
            const config = {
              type: 'line',
              data: data,
              options: {
                  scales: {
                       x: {
                           grid: {
                               display: false
                           }
                       }
                    },
                plugins: {
                  filler: {
                    propagate: false,
                  },
                },
                interaction: {
                  intersect: false,
                }
              },
            };
            const Nut_count_Chart = new Chart(
                document.getElementById('Nut_count_Chart'),
                config
            );
          
            var labels_dep_commune = {{ dep_commune_names|safe }}
            var datas_dep_commune = {{ dep_commune_sum_list|safe }}
            var dataset_dep_commune = []
            for (let i in datas_dep_commune) {
                const r = Math.floor(Math.random() * 255);
                const g = Math.floor(Math.random() * 255);
                const b = Math.floor(Math.random() * 255);
               dataset_dep_commune.push('rgba('+r+', '+g+', '+b+', 0.6)');
            }
            const dep_commune_data = {
            labels: labels_dep_commune,
            datasets: [{
                    label: 'Nut count average per Departement communes',
                data: datas_dep_commune,
                backgroundColor: dataset_dep_commune,
                hoverBorderWidth: "30px",
                }]
            };
            const dep_commune_config = {
                type: 'polarArea',
                data: dep_commune_data,
                options: {
                    scales: {
                       r: {
                           ticks: {
                               z: 1,
                               showLabelBackdrop: true,
                               backdropColor: "rgba(255,255,255,0.5)",
                               font: {
                                   weight: 600,
                               },
                           },
                           grid: false,
                       }
                    }
                }
            };
            const dep_commune_Chart = new Chart(
                document.getElementById('dep_commune_Chart'),
                dep_commune_config
            );
        </script>
{% endblock javascripts %}
